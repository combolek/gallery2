<?php
class Controller_Show extends Controller_Gallery {

    public function Album($id=1) {
	// In Kohana, all views are loaded and treated as objects.
	$this->template->header->active = "Browse Photos";
	$this->template->content = new View('show_album');

	$item = ORM::factory('Item', $id);

	$this->template->content->item = $item;
	$this->template->content->maxRows = 3;
	$this->template->content->maxColumns = 3;
	$this->template->content->children = $item->children;

	$gallery = Gallery::instance();
	$albumPath = $gallery->albums . '/';
	if (!empty($item->Path)) {
	    $albumPath .= $item->Path . '/';
	}
	$this->template->content->albumPath = $albumPath;
    }

    public function Item($parentId, $id) {
	// In Kohana, all views are loaded and treated as objects.
	$this->template->header->active = "Browse Photos";
	$this->template->content = new View('show_item');

	$item = ORM::factory('Item', $id);
	$parent = $item->parent;

	$gallery = Gallery::instance();
	$albumPath = $gallery->albums . '/';
	if (!empty($parent->Path)) {
	    $albumPath .= $parent->Path . '/';
	}
	$this->template->content->path = $albumPath . $item->Path;
	$this->template->content->item = $item;
    }

    public function __call($method, $arguments) {
	// Disable auto-rendering
	$this->auto_render = FALSE;

	// By defining a __call method, all pages routed to this controller
	// that result in 404 errors will be handled by this method, instead of
	// being displayed as "Page Not Found" errors.
	echo 'This text is generated by __call. If you expected the index page, you need to use: welcome/index/' . Router::$current_uri;
    }
}
?>